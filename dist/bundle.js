async function wapper(){const VERSION="v.1.0.0.beta";const PLAY_DATA_URL="https://p.eagate.573.jp/game/popn/unilab/playdata";const MEDAL_IMAGE_URL="https://eacache.s.konaminet.jp/game/popn/unilab/images/p/common/medal";const SONGS=[{"song":"3 A.M. ディテクティブ・ゲーム","theme":"PEAK","avg":2216,"max":2366,"wr":2352},{"song":"532nm","theme":"NOTES","avg":2042,"max":2176,"wr":2170},{"song":"ABSOLUTE","theme":"TRICKY","avg":2132,"max":2290,"wr":2271},{"song":"Afterimage d'automne","theme":"TRICKY","avg":2402,"max":2646,"wr":2618},{"song":"Akash","theme":"PEAK","avg":1872,"max":2004,"wr":1993},{"song":"Alicy","theme":"NOTES","avg":2555,"max":2740,"wr":2728},{"song":"Amabie","theme":"TRICKY","avg":2111,"max":2232,"wr":2224},{"song":"Angelic Jelly","theme":"PEAK","avg":2275,"max":2456,"wr":2442},{"song":"Arcanos","theme":"TRICKY","avg":2090,"max":2222,"wr":2210},{"song":"BabeL ～Next Story～","theme":"SOF-LAN","avg":2469,"max":2756,"wr":2718},{"song":"beat it together","theme":"KAIDAN","avg":2086,"max":2260,"wr":2244},{"song":"BEEF","theme":"CHORD","avg":2289,"max":2382,"wr":2371},{"song":"Blind","theme":"NOTES","avg":2277,"max":2422,"wr":2412},{"song":"BLSTR","theme":"NOTES","avg":2108,"max":2272,"wr":2257},{"song":"Bolide","theme":"KAIDAN","avg":2177,"max":2350,"wr":2325},{"song":"brave!","theme":"NOTES","avg":1971,"max":2088,"wr":2086},{"song":"Butter-FLY","theme":"CHORD","avg":2707,"max":2794,"wr":2791},{"song":"CARNIVOROUS","theme":"NOTES","avg":2180,"max":2298,"wr":2289},{"song":"CARTOON☆RagHour","theme":"KAIDAN","avg":2185,"max":2358,"wr":2337},{"song":"Cassandra","theme":"PEAK","avg":1666,"max":1856,"wr":1839},{"song":"Chaos:Q","theme":"SOF-LAN","avg":1767,"max":2148,"wr":2107},{"song":"Cloud 9","theme":"TRICKY","avg":2112,"max":2276,"wr":2265},{"song":"coffee break","theme":"TRICKY","avg":1717,"max":1902,"wr":1881},{"song":"Colors","theme":"KAIDAN","avg":1919,"max":2136,"wr":2106},{"song":"Come to Life","theme":"SOF-LAN","avg":2130,"max":2328,"wr":2310},{"song":"Crumble Soul","theme":"KAIDAN","avg":2261,"max":2372,"wr":2363},{"song":"CURUS","theme":"CHORD","avg":2561,"max":2638,"wr":2634},{"song":"Daily Lunch Special","theme":"CHORD","avg":2614,"max":2766,"wr":2755},{"song":"De-a lungul vietii","theme":"NOTES","avg":2302,"max":2500,"wr":2483},{"song":"Deep Magenta","theme":"CHORD","avg":2449,"max":2574,"wr":2566},{"song":"demolizione","theme":"TRICKY","avg":1446,"max":1560,"wr":1552},{"song":"Denpasar","theme":"NOTES","avg":1869,"max":2000,"wr":1994},{"song":"Desire","theme":"PEAK","avg":2021,"max":2140,"wr":2133},{"song":"Dimension Gale","theme":"NOTES","avg":2283,"max":2424,"wr":2422},{"song":"Drizzly Venom","theme":"PEAK","avg":2065,"max":2176,"wr":2164},{"song":"EBONY & IVORY","theme":"KAIDAN","avg":1892,"max":2040,"wr":2033},{"song":"Echoes","theme":"TRICKY","avg":1922,"max":2074,"wr":2060},{"song":"Engraved Mark","theme":"NOTES","avg":2309,"max":2478,"wr":2471},{"song":"Ensamble Forecast 3/28","theme":"NOTES","avg":2184,"max":2318,"wr":2303},{"song":"Fly far bounce","theme":"SOF-LAN","avg":1749,"max":1882,"wr":1865},{"song":"GALAXY FOREST 11.6&12 ","theme":"PEAK","avg":896,"max":1036,"wr":1024},{"song":"GET WILD","theme":"NOTES","avg":2435,"max":2550,"wr":2540},{"song":"GO²TOS","theme":"CHORD","avg":2072,"max":2132,"wr":2128},{"song":"Gotta Get My Groove On","theme":"CHORD","avg":2117,"max":2198,"wr":2195},{"song":"Gradation","theme":"CHORD","avg":2097,"max":2222,"wr":2215},{"song":"Greening","theme":"CHORD","avg":2418,"max":2560,"wr":2548},{"song":"HADROS GALE","theme":"NOTES","avg":2194,"max":2334,"wr":2326},{"song":"H@appy Fever Forever!!","theme":"SOF-LAN","avg":2432,"max":2686,"wr":2668},{"song":"High Gravity","theme":"KAIDAN","avg":2317,"max":2444,"wr":2440},{"song":"HYENA","theme":"NOTES","avg":2310,"max":2498,"wr":2493},{"song":"IKKI! Explosion","theme":"CHORD","avg":2483,"max":2652,"wr":2642},{"song":"INHERITANCE of WILL","theme":"KAIDAN","avg":2333,"max":2476,"wr":2466},{"song":"Inside Insight","theme":"KAIDAN","avg":2184,"max":2292,"wr":2280},{"song":"Into The Light","theme":"NOTES","avg":2200,"max":2286,"wr":2280},{"song":"Kicky Kemari Kicker","theme":"KAIDAN","avg":1918,"max":2050,"wr":2047},{"song":"Les Vague","theme":"SOF-LAN","avg":2291,"max":2476,"wr":2462},{"song":"Linus","theme":"PEAK","avg":2289,"max":2468,"wr":2455},{"song":"Little Little Princess","theme":"NOTES","avg":2599,"max":2700,"wr":2692},{"song":"LOTUS","theme":"NOTES","avg":2303,"max":2436,"wr":2431},{"song":"L'eternita","theme":"SOF-LAN","avg":1882,"max":2136,"wr":2098},{"song":"MADSPEED狂信道","theme":"KAIDAN","avg":2014,"max":2212,"wr":2164},{"song":"Magical 4","theme":"SOF-LAN","avg":1796,"max":2074,"wr":2041},{"song":"Miracle 4","theme":"SOF-LAN","avg":2063,"max":2280,"wr":2262},{"song":"MOON","theme":"KAIDAN","avg":2122,"max":2268,"wr":2266},{"song":"nalca","theme":"KAIDAN","avg":2193,"max":2340,"wr":2331},{"song":"NEW PEOPLE","theme":"CHORD","avg":2463,"max":2580,"wr":2575},{"song":"On top of the world","theme":"NOTES","avg":2576,"max":2772,"wr":2748},{"song":"Over Da Moon","theme":"PEAK","avg":2343,"max":2466,"wr":2457},{"song":"Pacify","theme":"NOTES","avg":2237,"max":2370,"wr":2363},{"song":"paparazzi","theme":"KAIDAN","avg":2035,"max":2168,"wr":2153},{"song":"Phlox","theme":"CHORD","avg":2606,"max":2722,"wr":2707},{"song":"Popperz Chronicle","theme":"SOF-LAN","avg":1748,"max":2068,"wr":2014},{"song":"Poppin' Soda","theme":"CHORD","avg":2524,"max":2592,"wr":2588},{"song":"Psyche Planet-V","theme":"NOTES","avg":2291,"max":2500,"wr":2489},{"song":"pure","theme":"CHORD","avg":1635,"max":1736,"wr":1733},{"song":"Red Cape Theorem","theme":"KAIDAN","avg":2057,"max":2176,"wr":2166},{"song":"Riot of Color","theme":"PEAK","avg":2095,"max":2262,"wr":2256},{"song":"say...but in vain","theme":"SOF-LAN","avg":2005,"max":2212,"wr":2189},{"song":"Scarlet Pinheel","theme":"KAIDAN","avg":2138,"max":2276,"wr":2266},{"song":"\"Schall\" we step？","theme":"KAIDAN","avg":2245,"max":2426,"wr":2410},{"song":"School Life","theme":"SOF-LAN","avg":1690,"max":1884,"wr":1862},{"song":"SESSION With You!","theme":"CHORD","avg":2424,"max":2516,"wr":2508},{"song":"Shades of Day","theme":"PEAK","avg":2294,"max":2420,"wr":2408},{"song":"Shining Wizard","theme":"NOTES","avg":2138,"max":2268,"wr":2263},{"song":"SHION（VENUS mix）","theme":"PEAK","avg":2369,"max":2518,"wr":2502},{"song":"Six String Proof","theme":"KAIDAN","avg":2048,"max":2234,"wr":2210},{"song":"Soul On Fire","theme":"KAIDAN","avg":2636,"max":2800,"wr":2789},{"song":"SPEED KING ON FIRE","theme":"PEAK","avg":2149,"max":2310,"wr":2290},{"song":"SPICY PIECE (Ryu☆Remix)","theme":"SOF-LAN","avg":1854,"max":2010,"wr":2002},{"song":"Stella Sinistra","theme":"KAIDAN","avg":2088,"max":2272,"wr":2255},{"song":"Strawberry Chu♡Chu♡","theme":"TRICKY","avg":2229,"max":2410,"wr":2382},{"song":"Struggle","theme":"NOTES","avg":2074,"max":2168,"wr":2163},{"song":"SUPER SUMMER SALE","theme":"KAIDAN","avg":2334,"max":2464,"wr":2456},{"song":"Sweet,Sweet,Sweet.","theme":"CHORD","avg":2376,"max":2478,"wr":2472},{"song":"Symsonic Breeze","theme":"KAIDAN","avg":2119,"max":2268,"wr":2266},{"song":"Synergy For Angels","theme":"NOTES","avg":2362,"max":2564,"wr":2553},{"song":"The Sky of Sadness","theme":"KAIDAN","avg":2203,"max":2356,"wr":2340},{"song":"The Zoo Zone","theme":"NOTES","avg":2112,"max":2264,"wr":2261},{"song":"TOXIC VIBRATION","theme":"NOTES","avg":2373,"max":2542,"wr":2532},{"song":"UNBOUND MIND","theme":"TRICKY","avg":2405,"max":2538,"wr":2522},{"song":"Welcome to pop'n fantasy","theme":"NOTES","avg":2158,"max":2262,"wr":2260},{"song":"will","theme":"PEAK","avg":2080,"max":2238,"wr":2229},{"song":"Windy Fairy","theme":"KAIDAN","avg":2093,"max":2238,"wr":2222},{"song":"World Spider Web","theme":"NOTES","avg":2361,"max":2522,"wr":2512},{"song":"ZEPHYRANTHES","theme":"NOTES","avg":2412,"max":2568,"wr":2567},{"song":"μ9","theme":"PEAK","avg":2437,"max":2574,"wr":2569},{"song":"哀彩","theme":"NOTES","avg":2409,"max":2532,"wr":2526},{"song":"蒼い弓箭","theme":"KAIDAN","avg":2147,"max":2270,"wr":2263},{"song":"蒼が消えるとき","theme":"PEAK","avg":2320,"max":2464,"wr":2452},{"song":"緋月の狂想曲","theme":"PEAK","avg":1958,"max":2128,"wr":2112},{"song":"朱と碧のランページ","theme":"PEAK","avg":2539,"max":2648,"wr":2646},{"song":"浅見文彦の事件簿～迷宮荘のワンピース","theme":"TRICKY","avg":2038,"max":2230,"wr":2191},{"song":"明日への誓い","theme":"PEAK","avg":2298,"max":2442,"wr":2429},{"song":"アルストロメリア","theme":"KAIDAN","avg":2471,"max":2606,"wr":2598},{"song":"アルレシャ","theme":"CHORD","avg":2169,"max":2248,"wr":2247},{"song":"アンデスの太陽","theme":"CHORD","avg":2223,"max":2320,"wr":2312},{"song":"怒りと共に去りぬ！！","theme":"NOTES","avg":2269,"max":2380,"wr":2374},{"song":"怒れる大きな白い馬～S.S.D.の役～","theme":"SOF-LAN","avg":1952,"max":2154,"wr":2133},{"song":"一触即発☆禅ガール","theme":"PEAK","avg":1950,"max":2132,"wr":2115},{"song":"異能対決!VS.淀ジョル","theme":"NOTES","avg":2023,"max":2144,"wr":2142},{"song":"ウソツキ横丁は雨模様","theme":"TRICKY","avg":2263,"max":2462,"wr":2441},{"song":"憂恋☆アクティベーション","theme":"KAIDAN","avg":2315,"max":2466,"wr":2457},{"song":"永遠という名の媚薬 ～Pyramid Power・Death Match ver.～","theme":"SOF-LAN","avg":1846,"max":2196,"wr":2168},{"song":"おーまい！らぶりー！すうぃーてぃ！だーりん！","theme":"PEAK","avg":2355,"max":2522,"wr":2499},{"song":"おたすけ！アン子ちゃん (シノビアンレディーのテーマ 弐)","theme":"NOTES","avg":2402,"max":2580,"wr":2561},{"song":"カタルシスの月","theme":"CHORD","avg":2544,"max":2640,"wr":2637},{"song":"ガッテンだ！！","theme":"SOF-LAN","avg":2069,"max":2328,"wr":2309},{"song":"烏","theme":"PEAK","avg":1775,"max":1878,"wr":1876},{"song":"ギターケンドー","theme":"PEAK","avg":2033,"max":2152,"wr":2146},{"song":"キャトられ♥恋はモ～モク","theme":"NOTES","avg":2604,"max":2806,"wr":2788},{"song":"狂水一華","theme":"NOTES","avg":2376,"max":2508,"wr":2495},{"song":"キルト","theme":"NOTES","avg":2523,"max":2644,"wr":2640},{"song":"禁じられた契約","theme":"TRICKY","avg":2269,"max":2378,"wr":2372},{"song":"空想モダニズム","theme":"CHORD","avg":2394,"max":2464,"wr":2463},{"song":"空想モダニズム -Alice Schach remix-","theme":"PEAK","avg":2163,"max":2302,"wr":2280},{"song":"黒髪乱れし修羅となりて","theme":"NOTES","avg":2545,"max":2748,"wr":2745},{"song":"黒き螺旋のクレイドル","theme":"NOTES","avg":2409,"max":2526,"wr":2523},{"song":"結果オーライ！相性チェック","theme":"CHORD","avg":2328,"max":2388,"wr":2383},{"song":"玄兎ノ舞","theme":"PEAK","avg":2277,"max":2418,"wr":2415},{"song":"ゴールデンハート　ft. Kimberley Nutbey","theme":"KAIDAN","avg":2400,"max":2522,"wr":2514},{"song":"恋とメロンとキューピット","theme":"NOTES","avg":2155,"max":2338,"wr":2330},{"song":"恋はどう？モロ◎波動OK☆方程式！！","theme":"CHORD","avg":2647,"max":2778,"wr":2766},{"song":"黒点","theme":"PEAK","avg":2449,"max":2644,"wr":2618},{"song":"コルドバの女","theme":"KAIDAN","avg":1952,"max":2088,"wr":2077},{"song":"コンビニエンスドラマ","theme":"TRICKY","avg":2081,"max":2242,"wr":2224},{"song":"左脳スパーク","theme":"CHORD","avg":2632,"max":2756,"wr":2749},{"song":"サヨナラ・ヘヴン","theme":"TRICKY","avg":2365,"max":2540,"wr":2509},{"song":"残酷な天使のテーゼ","theme":"TRICKY","avg":1646,"max":1736,"wr":1733},{"song":"幸せを謳う詩","theme":"SOF-LAN","avg":1862,"max":2020,"wr":2011},{"song":"辞世テンプレート","theme":"CHORD","avg":2754,"max":2912,"wr":2897},{"song":"シャムシールの舞","theme":"KAIDAN","avg":2211,"max":2362,"wr":2354},{"song":"人妖絵巻其の二「鬼」～夜叉の祭は終夜～","theme":"NOTES","avg":2409,"max":2538,"wr":2530},{"song":"水月鏡花のコノテーション","theme":"CHORD","avg":2507,"max":2590,"wr":2588},{"song":"青春の扉","theme":"NOTES","avg":2108,"max":2330,"wr":2325},{"song":"零と弌の鍵の唄","theme":"KAIDAN","avg":2242,"max":2422,"wr":2408},{"song":"千年ノ理","theme":"KAIDAN","avg":2303,"max":2466,"wr":2456},{"song":"そこはかとなくロマンセ","theme":"TRICKY","avg":1923,"max":2056,"wr":2041},{"song":"√太陽系◎ドーナツ化計画∞∀∞","theme":"PEAK","avg":2290,"max":2426,"wr":2414},{"song":"魂依","theme":"KAIDAN","avg":2102,"max":2246,"wr":2233},{"song":"地方創生☆チクワクティクス","theme":"PEAK","avg":2210,"max":2358,"wr":2350},{"song":"超恋愛☆エクストリーム・ガール","theme":"CHORD","avg":2504,"max":2612,"wr":2604},{"song":"チルノのパーフェクトさんすう教室","theme":"KAIDAN","avg":2378,"max":2526,"wr":2514},{"song":"つばめ","theme":"PEAK","avg":1852,"max":1992,"wr":1986},{"song":"徹頭徹尾Thrive at Perfect Fourth","theme":"PEAK","avg":2245,"max":2394,"wr":2381},{"song":"天上の星 ～黎明記～","theme":"SOF-LAN","avg":2104,"max":2222,"wr":2215},{"song":"電波の暮らし","theme":"CHORD","avg":1971,"max":2054,"wr":2050},{"song":"桃花恋情","theme":"CHORD","avg":2512,"max":2592,"wr":2583},{"song":"どうなっちゃったって","theme":"CHORD","avg":2113,"max":2272,"wr":2267},{"song":"鳥無き島にて","theme":"TRICKY","avg":2166,"max":2342,"wr":2326},{"song":"取り残された美術(Arranged:HiZuMi)","theme":"NOTES","avg":2134,"max":2242,"wr":2235},{"song":"†渚の小悪魔ラヴリィ～レイディオ†","theme":"CHORD","avg":2515,"max":2642,"wr":2639},{"song":"ナスカの丘","theme":"CHORD","avg":2521,"max":2628,"wr":2614},{"song":"懐色坂","theme":"KAIDAN","avg":1999,"max":2134,"wr":2121},{"song":"西麻布水道曲","theme":"SOF-LAN","avg":1263,"max":1564,"wr":1522},{"song":"ネリと琥珀糖","theme":"KAIDAN","avg":2183,"max":2316,"wr":2307},{"song":"旗（Mystic Mix）","theme":"NOTES","avg":2243,"max":2416,"wr":2411},{"song":"洟・月・奇蹟","theme":"PEAK","avg":1696,"max":1810,"wr":1802},{"song":"疾風","theme":"KAIDAN","avg":2417,"max":2574,"wr":2563},{"song":"霽れと褻と穢れ","theme":"NOTES","avg":2334,"max":2438,"wr":2424},{"song":"表裏一体！？怪盗いいんちょの悩み♥","theme":"NOTES","avg":2451,"max":2618,"wr":2600},{"song":"プリンシプル","theme":"CHORD","avg":2891,"max":3000,"wr":2999},{"song":"ブルーローズイノセンス","theme":"NOTES","avg":2175,"max":2300,"wr":2293},{"song":"プロレタリア狂騒歌","theme":"NOTES","avg":2521,"max":2690,"wr":2678},{"song":"ペリーでぇす！","theme":"KAIDAN","avg":2288,"max":2434,"wr":2429},{"song":"鳳凰～Chinese Phoenix Mix～","theme":"PEAK","avg":1960,"max":2194,"wr":2166},{"song":"ぼくらの16bit戦争","theme":"KAIDAN","avg":2168,"max":2310,"wr":2293},{"song":"星屑の夜果て","theme":"KAIDAN","avg":2389,"max":2538,"wr":2524},{"song":"星屑ブレスレット","theme":"KAIDAN","avg":1888,"max":2028,"wr":2013},{"song":"ほしのつくりかた","theme":"PEAK","avg":1888,"max":1972,"wr":1972},{"song":"ボタン","theme":"CHORD","avg":2519,"max":2626,"wr":2617},{"song":"ポチコの幸せな日常","theme":"KAIDAN","avg":2409,"max":2562,"wr":2549},{"song":"ホピタスコピラ","theme":"KAIDAN","avg":2163,"max":2350,"wr":2339},{"song":"滅びに至るエランプシス","theme":"NOTES","avg":2422,"max":2532,"wr":2529},{"song":"マイアガル、マイオドル","theme":"KAIDAN","avg":2313,"max":2458,"wr":2450},{"song":"マインド・ゲーム","theme":"KAIDAN","avg":2106,"max":2240,"wr":2238},{"song":"魔界！痛快！ヘルダンス","theme":"SOF-LAN","avg":2006,"max":2200,"wr":2179},{"song":"巻寿司戦隊ウマイヤン ～コードネームはグリーン～","theme":"PEAK","avg":2507,"max":2614,"wr":2606},{"song":"曼珠沙華","theme":"PEAK","avg":2272,"max":2428,"wr":2424},{"song":"乱れた風紀に天罰を","theme":"SOF-LAN","avg":1911,"max":2130,"wr":2108},{"song":"ミラクル・スイート・スイーツ・マジック！！","theme":"SOF-LAN","avg":2416,"max":2552,"wr":2532},{"song":"無意識のフィロソフィア","theme":"CHORD","avg":2415,"max":2550,"wr":2536},{"song":"夢幻ノ光","theme":"CHORD","avg":2158,"max":2226,"wr":2222},{"song":"めうめうぺったんたん！！","theme":"CHORD","avg":2901,"max":3060,"wr":3048},{"song":"ラピストリアの約束","theme":"CHORD","avg":2347,"max":2430,"wr":2426},{"song":"ランカーキラーガール","theme":"NOTES","avg":2397,"max":2522,"wr":2514},{"song":"リナリア","theme":"KAIDAN","avg":2018,"max":2154,"wr":2141},{"song":"麗破唖甦～rebirth～","theme":"PEAK","avg":2281,"max":2422,"wr":2419},{"song":"流星☆ハニー Perforation Mix","theme":"NOTES","avg":2295,"max":2482,"wr":2473},{"song":"繚乱ヒットチャート","theme":"CHORD","avg":2620,"max":2874,"wr":2847},{"song":"凛として咲く花の如く","theme":"NOTES","avg":2421,"max":2532,"wr":2531},{"song":"レトロスペクト路","theme":"TRICKY","avg":2329,"max":2464,"wr":2448},{"song":"恋愛観測 -Rock Band Ver.-","theme":"NOTES","avg":2282,"max":2404,"wr":2398},{"song":"六兆年と一夜物語","theme":"NOTES","avg":1960,"max":2068,"wr":2061},{"song":"路男","theme":"CHORD","avg":2714,"max":2858,"wr":2850}];const domparser=new DOMParser();const ConvToUTF8=(res)=>{return res.arrayBuffer().then((buffer)=>{if(res.headers.get("Content-Type").includes("UTF-8")){return new TextDecoder().decode(buffer)}else{return new TextDecoder("Shift_JIS").decode(buffer)}})};const idx=await fetch(`${PLAY_DATA_URL}/index.html`).then(ConvToUTF8).then(text=>domparser.parseFromString(text,"text/html"));const player=idx.querySelector("#status_table > div.st_box > div:nth-child(2)").textContent;const chara=idx.getElementsByTagName('img').item(9).getAttribute("src");const GetMusicData=(url,level)=>{return fetch(url).then(ConvToUTF8).then(text=>domparser.parseFromString(text,"text/html")).then(doc=>doc.querySelectorAll("ul.mu_list_table > li")).then(list=>{return Array.from(list).filter(li=>li.firstElementChild.className.startsWith("col")).map(li=>[li.firstElementChild.firstElementChild.textContent,li.firstElementChild.lastElementChild.textContent,li.children[3].textContent,li.children[3].firstChild.src.replace(`${MEDAL_IMAGE_URL}/meda_`,"").replace(".png",""),]).map(([song,genre,score,medal])=>{return{song,genre,score,medal,level}})})};const promises=[[0,46],[1,46],[2,46],[3,46],[4,46],[5,46],[6,46],[7,46],[8,46],[9,46],[10,46],].map(([page,level])=>GetMusicData(`${PLAY_DATA_URL}/mu_lv.html?page=${page}&level=${level}`,level));let music_data=(await Promise.all(promises)).flat();const POW=1.175;const MINBPI=0;const CalcBPI=(s,k,z,m)=>{const CalcPGF=(x)=>{return x===m?m*2:1+(x/m-0.5)/(1-x/m)};const S=CalcPGF(s);const K=CalcPGF(k);const Z=CalcPGF(z);const S_=S/K;const Z_=Z/K;if(s>=k){const result=(100*(Math.pow(Math.log(S_),POW)/Math.pow(Math.log(Z_),POW)));return Math.max(MINBPI,Math.round(result*100)/100)}else{const result=(-100*(Math.pow(-Math.log(S_),POW)/Math.pow(Math.log(Z_),POW)));return Math.max(MINBPI,Math.round(result*100)/100)}};const CalcAvgBPI=(music_num,music_data)=>{const coef=Math.log2(music_num);const sumbpi=music_data.reduce((sum,i)=>sum+(Math.pow(Number(i.bpi),coef))/music_num,0);const result=Math.pow(sumbpi,1/coef);return Math.round(result*100)/100};Object.keys(music_data).map(item=>{const SONG=SONGS.find(({song})=>song===music_data[item].song);if(SONG){const bmscore=Math.round(SONG.max*(1-(100000-music_data[item].score)/60000));if(bmscore>0){const bpi=CalcBPI(bmscore,SONG.avg,SONG.wr,SONG.max);music_data[item].bpi=Math.max(bpi,MINBPI);music_data[item].theme=SONG.theme}else{music_data[item].bpi=MINBPI;music_data[item].theme=SONG.theme}}else{console.log(music_data[item].song);delete music_data[item]}});music_data=music_data.filter(a=>!!a);music_data.sort((a,b)=>{if(a.score<b.score)return 1;if(a.score>b.score)return-1;return 0});music_data.sort((a,b)=>{if(a.bpi<b.bpi)return 1;if(a.bpi>b.bpi)return-1;return 0});const avg_data=music_data.filter(i=>i.score!=0);const avg_score=Math.round(avg_data.reduce((sum,i)=>sum+Number(i.score),0)/avg_data.length);const avg_bpi=CalcAvgBPI(music_data.length,music_data);const n=music_data.filter(i=>i.theme=="NOTES").slice(0,10);const c=music_data.filter(i=>i.theme=="CHORD").slice(0,10);const p=music_data.filter(i=>i.theme=="PEAK").slice(0,10);const t=music_data.filter(i=>i.theme=="TRICKY").slice(0,10);const k=music_data.filter(i=>i.theme=="KAIDAN").slice(0,10);const s=music_data.filter(i=>i.theme=="SOF-LAN").slice(0,10);const notes=Math.round(n.reduce((sum,i)=>sum+Number(i.bpi),0));const chord=Math.round(c.reduce((sum,i)=>sum+Number(i.bpi),0));const peak=Math.round(p.reduce((sum,i)=>sum+Number(i.bpi),0));const tricky=Math.round(t.reduce((sum,i)=>sum+Number(i.bpi),0));const kaidan=Math.round(k.reduce((sum,i)=>sum+Number(i.bpi),0));const soflan=Math.round(s.reduce((sum,i)=>sum+Number(i.bpi),0));const sum_radar=notes+chord+peak+tricky+kaidan+soflan;const top=music_data.slice(0,30);const bottom=music_data.slice(-30);const divEl=document.createElement("div");divEl.id="popnRadar";divEl.innerHTML=` <style scoped> .popnPage { display: flex; justify-content: center; color: #FFFFFF; background-color: #2D2D2D } .popnTable { background-color: #0D0D0D; border-collapse: collapse; } .popnTable caption { text-align: center; back-ground: #0D0D0D; } .popnTable tr { border-bottom: 2px solid #2D2D2D; } .popnTable th { padding: 4px; } .popnTable td { padding: 0 4px; white-space: nowrap; } .popnTable td img { vertical-align: middle; } .profileTable { margin: 5px auto; font-size: 14px; background-color: #0D0D0D; border-collapse: collapse; } .profileTable tr { border-bottom: 2px solid #2D2D2D; } .profileTable td { width: 175px; padding: 5px; } .profileTable td:first-child { font-weight: bold; } .profileTable canvas { position: right; width: 350px; height: 2500px; } .footnote { font-size: 10px; margin: 8px auto; color: gray; text-align: center; } @media (max-width: 768px) { .popnPage { flex-direction: column; } .popnTable { width: 100%; margin-bottom: 20px; } .profileTable { width: auto; } .popnTable th:first-child,td:first-child { min-width: 20px; } .popnTable th:nth-child(4),td:nth-child(4) { min-width: 40px; } .popnTable th:nth-child(5),td:nth-child(5) { min-width: 40px; } .popnTable th:nth-child(6),td:nth-child(6) { min-width: 50px; } } </style> <div class="popnPage"> <table class="profileTable"> <tr> <td>プレーヤー名</td> <td>${player}</td> <td rowspan="11"><canvas id="myChart"></canvas></td> </tr> <tr> <td>使用キャラクター</td> <td><img src="${chara}"></td> </tr> <tr> <td>平均スコア</td> <td>${avg_score}</td> </tr> <tr> <td>総合BPI</td> <td>${avg_bpi}</td> </tr> <tr> <td style="color:#FF40EB">NOTES</td> <td>${notes}</td> </tr> <tr> <td style="color:#84E000">CHORD</td> <td>${chord}</td> </tr> <tr> <td style="color:#FB6A00">PEAK</td> <td>${peak}</td> </tr> <tr> <td style="color:#8957DD">TRICKY</td> <td>${tricky}</td> </tr> <tr> <td style="color:#DD0000">KAIDAN</td> <td>${kaidan}</td> </tr> <tr> <td style="color:#0086E5">SOF-LAN</td> <td>${soflan}</td> </tr> <tr> <td style="color:#E6B422">合計レーダースコア</td> <td>${sum_radar}</td> </tr> </table> </div> <div class="popnPage"> <table class="popnTable"> <caption>TOP 30</caption> <tr> <th>BPI</th> <th>テーマ</th> <th>LV</th> <th>曲名</th> <th>スコア</th> <th>メダル</th> </tr> ${top.map(x => `<tr><td>${x.bpi}</td><td>${x.theme}</td><td>${x.level}</td><td width=400px>${x.song}</td><td>${x.score}</td><td><img src="${MEDAL_IMAGE_URL}/meda_${x.medal}.png"></td></tr>` ).join("")} </table> <table class="popnTable"> <caption>BOTTOM 30</caption> <tr> <th>BPI</th> <th>テーマ</th> <th>LV</th> <th>曲名</th> <th>スコア</th> <th>メダル</th> </tr> ${bottom.map(x => `<tr><td>${x.bpi}</td><td>${x.theme}</td><td>${x.level}</td><td width=400px>${x.song}</td><td>${x.score}</td><td><img src="${MEDAL_IMAGE_URL}/meda_${x.medal}.png"></td></tr>` ).join("")} </table> </div> <div class="footnote">ポップンノーツレーダー${VERSION}</div> `;document.body.innerHTML="";document.body.appendChild(divEl);const sc1=document.createElement("script");sc1.src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.js";const sc2=document.createElement("script");sc2.innerHTML=` var ctx = document.getElementById("myChart"); var myChart = new Chart(ctx, { type: 'radar', data: { labels: ["NOTES", "PEAK", "KAIDAN", "SOF-LAN", "TRICKY", "CHORD"], datasets: [{ label: "NOTES RADAR", backgroundColor: "rgba(0,180,60,0.2)", borderColor: "rgba(0,180,60,0.5)", pointBackgroundColor: "rgba(51,255,51,1)", pointBorderColor: "#fff", pointHoverBackgroundColor: "#fff", pointHoverBorderColor: "rgba(51,255,51,1)", hitRadius: 5, data: [${notes}, ${peak}, ${kaidan}, ${soflan}, ${tricky}, ${chord}] }] }, options: { responsive: true, maintainAspectRatio: false, scale: { ticks: { min: 0, max: 1000, stepSize: 200, display: false }, gridLines: { display: true, color: "rgba(242,242,242,0.2)", }, angleLines: { color: "rgba(255,255,250,0.2)", }, pointLabels: { fontSize: 10, color: "white", } }, legend: { labels: { fontSize: 15, } } } }); `;document.head.innerHTML="";document.head.appendChild(sc1);document.head.appendChild(sc2)} wapper()