async function wapper(){const VERSION="v.1.0.0.beta";const PLAY_DATA_URL="https://p.eagate.573.jp/game/popn/unilab/playdata";const MEDAL_IMAGE_URL="https://eacache.s.konaminet.jp/game/popn/unilab/images/p/common/medal";const SONGS=[{"song":"1/6billionth","avg":1989,"max":2118,"wr":2110},{"song":"50th Memorial Songs -The BEMANI History-","avg":2193,"max":2430,"wr":2405},{"song":"8000000","avg":2417,"max":2570,"wr":2565},{"song":"ACCELERATION","avg":2234,"max":2384,"wr":2376},{"song":"Aftermath","avg":2632,"max":2774,"wr":2755},{"song":"Amalgamation","avg":2268,"max":2432,"wr":2420},{"song":"Ancient Heritage","avg":2210,"max":2422,"wr":2413},{"song":"AsiaN distractive","avg":2460,"max":2620,"wr":2599},{"song":"ATTRACTION！","avg":2128,"max":2320,"wr":2307},{"song":"BBLLAASSTT!!","avg":2287,"max":2470,"wr":2462},{"song":"BEYOND THE EARTH","avg":2454,"max":2650,"wr":2620},{"song":"BILLION MONEY BAZOOKA","avg":2547,"max":2768,"wr":2755},{"song":"BLAZE∞BREEZE","avg":2389,"max":2536,"wr":2527},{"song":"Bye Bye","avg":2402,"max":2584,"wr":2565},{"song":"Caradbolg","avg":2730,"max":2912,"wr":2883},{"song":"Catch Our Fire!","avg":2441,"max":2614,"wr":2605},{"song":"Celsus","avg":2481,"max":2618,"wr":2604},{"song":"chilblain","avg":2357,"max":2498,"wr":2490},{"song":"Cleopatrysm","avg":2148,"max":2348,"wr":2328},{"song":"Craze for You","avg":2063,"max":2312,"wr":2282},{"song":"Dance to Blue (Respect Style)","avg":2091,"max":2282,"wr":2268},{"song":"Danza Pantera","avg":2846,"max":2986,"wr":2965},{"song":"Der Wald(kors k Remix)","avg":2432,"max":2628,"wr":2617},{"song":"DOES NOT COMPUTE","avg":2459,"max":2572,"wr":2566},{"song":"Dogu Ditty","avg":2494,"max":2688,"wr":2678},{"song":"El venenciador","avg":2219,"max":2428,"wr":2411},{"song":"Empty Backdoor","avg":2306,"max":2432,"wr":2424},{"song":"Fate No.23","avg":2384,"max":2586,"wr":2575},{"song":"Floccinaucinihilipilification","avg":2263,"max":2446,"wr":2435},{"song":"FLOWER","avg":2442,"max":2662,"wr":2655},{"song":"For Dear ～","avg":2502,"max":2594,"wr":2589},{"song":"full-consciousness green","avg":2547,"max":2730,"wr":2725},{"song":"Ge-Ko-Ku-Jo","avg":1950,"max":2082,"wr":2074},{"song":"Habits","avg":2278,"max":2444,"wr":2424},{"song":"Hatcha Metcha Party","avg":2462,"max":2636,"wr":2618},{"song":"Holy Forest","avg":2093,"max":2246,"wr":2230},{"song":"HypArcSin(x)","avg":2607,"max":2852,"wr":2817},{"song":"I just hate you","avg":2706,"max":2906,"wr":2891},{"song":"ice crystals","avg":1939,"max":2096,"wr":2083},{"song":"IMPLANTATION","avg":1637,"max":1820,"wr":1815},{"song":"In The Ruins","avg":2084,"max":2240,"wr":2229},{"song":"INFINITY","avg":2444,"max":2588,"wr":2580},{"song":"Invisible Farewell","avg":2494,"max":2812,"wr":2781},{"song":"I'm so Happy","avg":1999,"max":2112,"wr":2109},{"song":"Jack in the Box","avg":2589,"max":2774,"wr":2754},{"song":"Jetcoaster Windy","avg":2256,"max":2392,"wr":2379},{"song":"Journey","avg":2422,"max":2634,"wr":2621},{"song":"KIMONO♥PRINCESS","avg":2229,"max":2418,"wr":2408},{"song":"KING of the SEA","avg":2387,"max":2600,"wr":2579},{"song":"La Lumiere","avg":1944,"max":2124,"wr":2110},{"song":"LIKE A VAMPIRE","avg":2520,"max":2696,"wr":2684},{"song":"LIMIT TOPPA REVOLUTION","avg":2497,"max":2718,"wr":2693},{"song":"Little prayer","avg":2439,"max":2586,"wr":2577},{"song":"♥LOVE² シュガ→♥ (かめりあ&ななひら's Over-Sweet-Dempa ♥LOVE² シュガ→♥な恋愛教室 Remix)","avg":2496,"max":2728,"wr":2711},{"song":"Manhattan Sports Club","avg":1619,"max":1758,"wr":1744},{"song":"Maritare!","avg":923,"max":1056,"wr":1047},{"song":"Miracle 4 RELOADED","avg":2375,"max":2766,"wr":2730},{"song":"Monkshood","avg":2115,"max":2332,"wr":2308},{"song":"murmur twins","avg":2221,"max":2456,"wr":2443},{"song":"Mychronicle","avg":2285,"max":2442,"wr":2433},{"song":"Mynarco","avg":2308,"max":2498,"wr":2484},{"song":"NINE PIECE","avg":2388,"max":2608,"wr":2587},{"song":"nostos","avg":2337,"max":2594,"wr":2558},{"song":"Nove Primavere","avg":2201,"max":2466,"wr":2436},{"song":"On dish or maindish?","avg":2601,"max":2736,"wr":2722},{"song":"ON-DO","avg":2148,"max":2328,"wr":2315},{"song":"Pa la la 42","avg":1872,"max":2068,"wr":2046},{"song":"Peragro","avg":2373,"max":2532,"wr":2522},{"song":"perditus†paradisus","avg":1980,"max":2226,"wr":2192},{"song":"PITAゴラス☆KISS","avg":2350,"max":2572,"wr":2553},{"song":"popcorn parade","avg":2364,"max":2558,"wr":2538},{"song":"PRANA","avg":2349,"max":2494,"wr":2486},{"song":"Princess Roki","avg":2190,"max":2334,"wr":2314},{"song":"PUNISHER","avg":2704,"max":2890,"wr":2879},{"song":"quaver♪","avg":2547,"max":2704,"wr":2699},{"song":"Reconsideration","avg":2376,"max":2562,"wr":2546},{"song":"Revived After Ruined Shine","avg":2466,"max":2632,"wr":2603},{"song":"Romance","avg":2578,"max":2712,"wr":2704},{"song":"Russian Caravan Rhapsody","avg":2284,"max":2452,"wr":2441},{"song":"SDVX REMIX SELECTION for pop'n music vol.01","avg":2794,"max":3050,"wr":3023},{"song":"Slime Molds","avg":2357,"max":2510,"wr":2490},{"song":"smile","avg":2681,"max":2864,"wr":2851},{"song":"SPACE CRASH LANDING","avg":2141,"max":2272,"wr":2263},{"song":"Spiral Clouds","avg":2313,"max":2546,"wr":2510},{"song":"Squeeze","avg":2104,"max":2290,"wr":2280},{"song":"STERLING SILVER","avg":2384,"max":2562,"wr":2550},{"song":"Stories","avg":2129,"max":2308,"wr":2293},{"song":"Sweet Sweet ♥ Magic","avg":1904,"max":2064,"wr":2057},{"song":"Swinging Skulls","avg":2320,"max":2506,"wr":2480},{"song":"The last of world music","avg":2435,"max":2648,"wr":2622},{"song":"THE SAFARI - NEETs ver. -","avg":2357,"max":2488,"wr":2478},{"song":"The tyro's reverie","avg":1511,"max":1742,"wr":1722},{"song":"TRUTH behind U","avg":2349,"max":2480,"wr":2469},{"song":"V","avg":2698,"max":2912,"wr":2903},{"song":"Versa","avg":2352,"max":2602,"wr":2583},{"song":"Violently Car","avg":1903,"max":2168,"wr":2140},{"song":"virkatoの主題によるperson09風超絶技巧変奏曲","avg":2519,"max":2850,"wr":2757},{"song":"virtual killer","avg":2358,"max":2582,"wr":2560},{"song":"Visterhv","avg":2419,"max":2574,"wr":2563},{"song":"Votum stellarum -forest #25 RMX-","avg":2130,"max":2338,"wr":2313},{"song":"αρχη","avg":2350,"max":2508,"wr":2490},{"song":"暴レ焔","avg":2317,"max":2498,"wr":2482},{"song":"在るが儘に","avg":2745,"max":2910,"wr":2909},{"song":"己経忍不住了","avg":2180,"max":2328,"wr":2314},{"song":"怒れる大きな白い馬","avg":2010,"max":2224,"wr":2204},{"song":"一発逆転！××だらけのハッピー大運動会！！","avg":2278,"max":2426,"wr":2419},{"song":"ヴェルヴェット　バレット","avg":2553,"max":2762,"wr":2754},{"song":"うた","avg":2637,"max":2860,"wr":2828},{"song":"永遠という名の媚薬","avg":1398,"max":1652,"wr":1593},{"song":"エイプリルフールの唄","avg":2808,"max":2934,"wr":2920},{"song":"エキサイティング！！も・ちゃ・ちゃ☆","avg":2574,"max":2782,"wr":2772},{"song":"焔華","avg":2457,"max":2628,"wr":2609},{"song":"お江戸花吹雪 TEYAN-day MIX","avg":1408,"max":1518,"wr":1513},{"song":"お米の美味しい炊き方、そしてお米を食べることによるその効果。","avg":2414,"max":2600,"wr":2584},{"song":"乙女繚乱 舞い咲き誇れ","avg":2492,"max":2578,"wr":2575},{"song":"踊るフィーバーロボ　Eu-Robot mix","avg":2527,"max":2722,"wr":2713},{"song":"朧月覆う雲をも裂きぬ","avg":2515,"max":2722,"wr":2702},{"song":"革命パッショネイト","avg":2584,"max":2676,"wr":2669},{"song":"カゲロウ","avg":2393,"max":2542,"wr":2531},{"song":"カタルシスの月","avg":2945,"max":3070,"wr":3066},{"song":"彼女は快刀乱麻","avg":2532,"max":2668,"wr":2664},{"song":"鴉","avg":2401,"max":2494,"wr":2488},{"song":"煌-灼熱の裁き-","avg":2636,"max":2780,"wr":2772},{"song":"キルト（Patchworker RMX）","avg":2409,"max":2578,"wr":2562},{"song":"クラゲータ","avg":1870,"max":2048,"wr":2040},{"song":"黒髪乱れし修羅となりて～凛 edition～","avg":2692,"max":2930,"wr":2923},{"song":"月光蝶","avg":1887,"max":2046,"wr":2039},{"song":"けもののおうじゃ★めうめう","avg":2494,"max":2646,"wr":2640},{"song":"元禄花吹雪","avg":1942,"max":2132,"wr":2097},{"song":"恋する☆宇宙戦争っ！！","avg":2728,"max":2940,"wr":2913},{"song":"乞い祈みの撫子","avg":2226,"max":2386,"wr":2372},{"song":"極悪の華","avg":2610,"max":2744,"wr":2730},{"song":"この子の七つのお祝いに","avg":2225,"max":2418,"wr":2408},{"song":"コルトーン","avg":2301,"max":2556,"wr":2526},{"song":"サケビノミドリ","avg":2355,"max":2500,"wr":2480},{"song":"差無来！！","avg":2176,"max":2402,"wr":2376},{"song":"猿の経","avg":2131,"max":2328,"wr":2304},{"song":"ジオメトリック∮ティーパーティー","avg":1967,"max":2176,"wr":2136},{"song":"十界","avg":2616,"max":2758,"wr":2745},{"song":"漆黒のスペシャルプリンセスサンデー","avg":2598,"max":2736,"wr":2728},{"song":"銃弾は解を撃ち抜いて","avg":2504,"max":2652,"wr":2647},{"song":"情操ディストピア","avg":2410,"max":2532,"wr":2522},{"song":"少年リップルズ","avg":2673,"max":2858,"wr":2838},{"song":"如雨露姫が世界征服","avg":2314,"max":2458,"wr":2448},{"song":"神曲","avg":2619,"max":2798,"wr":2785},{"song":"真超深ＴＩＯＮ","avg":2529,"max":2686,"wr":2672},{"song":"スーパーモグー","avg":2486,"max":2730,"wr":2704},{"song":"水晶塔のオルカ","avg":2522,"max":2754,"wr":2718},{"song":"ススメ！少年！！","avg":2171,"max":2358,"wr":2349},{"song":"ストレイ・マーチ","avg":2789,"max":2978,"wr":2970},{"song":"世界の果てに約束の凱歌を-pop'n ver.-","avg":2351,"max":2494,"wr":2486},{"song":"セツナトリップ","avg":2523,"max":2674,"wr":2664},{"song":"造花の貌","avg":2497,"max":2652,"wr":2636},{"song":"誰がために陽はのぼる","avg":2741,"max":2932,"wr":2924},{"song":"たまゆら","avg":2026,"max":2150,"wr":2142},{"song":"断罪プラズマ","avg":2350,"max":2524,"wr":2507},{"song":"男々道","avg":1810,"max":2186,"wr":2159},{"song":"ちくわパフェだよ☆ＣＫＰ","avg":2812,"max":2978,"wr":2971},{"song":"地の記　獄編","avg":2258,"max":2398,"wr":2393},{"song":"デパ地下のお話","avg":2197,"max":2334,"wr":2327},{"song":"デュスノミア","avg":2078,"max":2250,"wr":2241},{"song":"でんがなマンガナ","avg":1960,"max":2116,"wr":2106},{"song":"天空ジオグラフィ","avg":2466,"max":2690,"wr":2666},{"song":"天庭","avg":2213,"max":2342,"wr":2339},{"song":"天庭 おとこのこ編","avg":2874,"max":3052,"wr":3032},{"song":"天和無双","avg":2443,"max":2756,"wr":2723},{"song":"突然ゴルゴンゾーラ","avg":2870,"max":3064,"wr":3051},{"song":"嘆きの樹 (BEMANI SYMPHONY Arr.)","avg":2299,"max":2658,"wr":2624},{"song":"なまいきプリンセス","avg":2791,"max":2966,"wr":2946},{"song":"猫侍の逆襲","avg":2226,"max":2466,"wr":2436},{"song":"螺子之人","avg":1634,"max":1864,"wr":1846},{"song":"背水之陣","avg":2791,"max":3062,"wr":3039},{"song":"ハラショー！おにぎりサーカス団☆","avg":2669,"max":2904,"wr":2888},{"song":"薔薇は永遠に美しく","avg":1979,"max":2148,"wr":2124},{"song":"叛逆のディスパレート","avg":2281,"max":2410,"wr":2401},{"song":"バンブーソード・ガール","avg":2382,"max":2626,"wr":2599},{"song":"白夜幻燈","avg":2144,"max":2336,"wr":2308},{"song":"フリーパス","avg":1853,"max":2016,"wr":1997},{"song":"文明開化","avg":2488,"max":2672,"wr":2661},{"song":"へんたいトリロジー","avg":2983,"max":3092,"wr":3089},{"song":"ホーンテッド★メイドランチ","avg":2823,"max":2998,"wr":2990},{"song":"鳳凰～Chinese Phoenix Mix～","avg":2326,"max":2590,"wr":2563},{"song":"放課後コンチェルティーノ～私だけの部室狂騒曲","avg":2303,"max":2582,"wr":2553},{"song":"ほおずき程度には赤い頭髪","avg":2573,"max":2828,"wr":2800},{"song":"僕らの旅はどこまでも","avg":1913,"max":2328,"wr":2284},{"song":"ポルターガイスト","avg":1850,"max":2028,"wr":2007},{"song":"ませまてぃっく♥ま+ま=まじっく！","avg":2554,"max":2710,"wr":2707},{"song":"ミサコの日記（見ちゃダメ！）","avg":2583,"max":2808,"wr":2793},{"song":"ムーニャポヨポヨスッポコニャーゴ","avg":2448,"max":2666,"wr":2656},{"song":"明鏡止水","avg":2066,"max":2256,"wr":2232},{"song":"メンテナンス物語","avg":2304,"max":2438,"wr":2427},{"song":"もうあおむけでいくしかない","avg":2283,"max":2488,"wr":2463},{"song":"ユメブキ","avg":2335,"max":2460,"wr":2454},{"song":"雷君","avg":2365,"max":2526,"wr":2520},{"song":"六花美人","avg":2315,"max":2520,"wr":2505},{"song":"龍と少女とデコヒーレンス","avg":2448,"max":2666,"wr":2658},{"song":"凛として咲く花の如く　～ひなビタ♪edition～","avg":2637,"max":2778,"wr":2775},{"song":"黎明スケッチブック","avg":2151,"max":2344,"wr":2319}];const domparser=new DOMParser();const ConvToUTF8=(res)=>{return res.arrayBuffer().then((buffer)=>{if(res.headers.get("Content-Type").includes("UTF-8")){return new TextDecoder().decode(buffer)}else{return new TextDecoder("Shift_JIS").decode(buffer)}})};const idx=await fetch(`${PLAY_DATA_URL}/index.html`).then(ConvToUTF8).then(text=>domparser.parseFromString(text,"text/html"));const player=idx.querySelector("#status_table > div.st_box > div:nth-child(2)").textContent;const chara=idx.getElementsByTagName('img').item(9).getAttribute("src");const GetMusicData=(url,level)=>{return fetch(url).then(ConvToUTF8).then(text=>domparser.parseFromString(text,"text/html")).then(doc=>doc.querySelectorAll("ul.mu_list_table > li")).then(list=>{return Array.from(list).filter(li=>li.firstElementChild.className.startsWith("col")).map(li=>[li.firstElementChild.firstElementChild.textContent,li.firstElementChild.lastElementChild.textContent,li.children[3].textContent,li.children[3].firstChild.src.replace(`${MEDAL_IMAGE_URL}/meda_`,"").replace(".png",""),]).map(([song,genre,score,medal])=>{return{song,genre,score,medal,level}})})};const promises=[[0,47],[1,47],[2,47],[3,47],[4,47],[5,47],[6,47],[7,47],[8,47],[9,47],].map(([page,level])=>GetMusicData(`${PLAY_DATA_URL}/mu_lv.html?page=${page}&level=${level}`,level));let music_data=(await Promise.all(promises)).flat();const POW=1.175;const MINBPI=0;const CalcBPI=(s,k,z,m)=>{const CalcPGF=(x)=>{return x===m?m*2:1+(x/m-0.5)/(1-x/m)};const S=CalcPGF(s);const K=CalcPGF(k);const Z=CalcPGF(z);const S_=S/K;const Z_=Z/K;if(s>=k){const result=(100*(Math.pow(Math.log(S_),POW)/Math.pow(Math.log(Z_),POW)));return Math.max(MINBPI,Math.round(result*100)/100)}else{const result=(-100*(Math.pow(-Math.log(S_),POW)/Math.pow(Math.log(Z_),POW)));return Math.max(MINBPI,Math.round(result*100)/100)}};const CalcAvgBPI=(music_num,music_data)=>{const coef=Math.log2(music_num);const sumbpi=music_data.reduce((sum,i)=>sum+(Math.pow(Number(i.bpi),coef))/music_num,0);const result=Math.pow(sumbpi,1/coef);return Math.round(result*100)/100};Object.keys(music_data).map(item=>{const SONG=SONGS.find(({song})=>song===music_data[item].song);if(SONG){const bmscore=Math.round(SONG.max*(1-(100000-music_data[item].score)/60000));if(bmscore>0){const bpi=CalcBPI(bmscore,SONG.avg,SONG.wr,SONG.max);music_data[item].bpi=Math.max(bpi,MINBPI)}else{music_data[item].bpi=MINBPI}}else{console.log(music_data[item].song);music_data[item].bpi=MINBPI}});music_data=music_data.filter(a=>!!a);music_data.sort((a,b)=>{if(a.score<b.score)return 1;if(a.score>b.score)return-1;return 0});music_data.sort((a,b)=>{if(a.bpi<b.bpi)return 1;if(a.bpi>b.bpi)return-1;return 0});const avg_data=music_data.filter(i=>i.score!=0);const avg_score=Math.round(avg_data.reduce((sum,i)=>sum+Number(i.score),0)/avg_data.length);const avg_bpi=CalcAvgBPI(music_data.length,music_data);const top=music_data.slice(0,30);const bottom=music_data.slice(-30);Object.keys(music_data).map(item=>{if(music_data[item].song.length>20){music_data[item].song=music_data[item].song.substr(0,20)+'...'}});const divEl=document.createElement("div");divEl.id="popnRadar";divEl.innerHTML=` <style scoped> .popnPage { display: flex; justify-content: center; color: #FFFFFF; background-color: #2D2D2D } .popnTable { background-color: #0D0D0D; border-collapse: collapse; } .popnTable caption { text-align: center; back-ground: #0D0D0D; } .popnTable tr { border-bottom: 2px solid #2D2D2D; } .popnTable th { padding: 4px; } .popnTable td { padding: 0 4px; white-space: nowrap; } .popnTable td img { vertical-align: middle; } .profileTable { margin: 5px auto; font-size: 14px; background-color: #0D0D0D; border-collapse: collapse; } .profileTable tr { border-bottom: 2px solid #2D2D2D; } .profileTable td { width: 175px; padding: 5px; } .profileTable td:first-child { font-weight: bold; } .profileTable canvas { position: right; width: 350px; height: 2500px; } .footnote { font-size: 10px; margin: 8px auto; color: gray; text-align: center; } @media (max-width: 768px) { .popnPage { flex-direction: column; } .popnTable { width: 100%; margin-bottom: 20px; } .profileTable { width: auto; } .popnTable th:first-child,td:first-child { min-width: 20px; } .popnTable th:nth-child(4),td:nth-child(4) { min-width: 40px; } .popnTable th:nth-child(5),td:nth-child(5) { min-width: 40px; } .popnTable th:nth-child(6),td:nth-child(6) { min-width: 50px; } } </style> <div class="popnPage"> <table class="profileTable"> <tr> <td>プレーヤー名</td> <td>${player}</td> </tr> <tr> <td>使用キャラクター</td> <td><img src="${chara}"></td> </tr> <tr> <td>平均スコア</td> <td>${avg_score}</td> </tr> <tr> <td>総合BPI</td> <td>${avg_bpi}</td> </tr> </table> </div> <div class="popnPage"> <table class="popnTable"> <caption>TOP 30</caption> <tr> <th>BPI</th> <th>LV</th> <th>曲名</th> <th>スコア</th> <th>メダル</th> </tr> ${top.map(x => `<tr><td>${x.bpi}</td><td>${x.level}</td><td width=250px>${x.song}</td><td>${x.score}</td><td><img src="${MEDAL_IMAGE_URL}/meda_${x.medal}.png"></td></tr>` ).join("")} </table> <table class="popnTable"> <caption>BOTTOM 30</caption> <tr> <th>BPI</th> <th>LV</th> <th>曲名</th> <th>スコア</th> <th>メダル</th> </tr> ${bottom.map(x => `<tr><td>${x.bpi}</td><td>${x.level}</td><td width=250px>${x.song}</td><td>${x.score}</td><td><img src="${MEDAL_IMAGE_URL}/meda_${x.medal}.png"></td></tr>` ).join("")} </table> </div> <div class="footnote">pop'n music BPI calculator ${VERSION}</div> `;document.body.innerHTML="";document.body.appendChild(divEl)} wapper()